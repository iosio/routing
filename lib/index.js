"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var util=require("@iosio/util"),createRouting=function(t){var e=window,a=function(t){if(!t)return"";var e=decodeURIComponent(t);return"false"!==e&&("true"===e||(0*+e==0?+e:e))},r=function(t){var r,n,o,i={};if(!((o=(t=t||e.location.search).indexOf("?"))<0)){for(var l=(t=t.substr(o+1)).split("&");r=l.shift();)void 0!==i[n=(r=r.split("=")).shift()]?i[n]=[].concat(i[n],a(r.shift())):i[n]=a(r.shift());return i}},n=function(t){var e,a,r,n=encodeURIComponent,o="";for(e in t)if(void 0!==(r=t[e]))if(util.isArray(r))for(a=0;a<r.length;a++)o&&(o+="&"),o+=n(e)+"="+n(r[a]);else o&&(o+="&"),o+=n(e)+"="+n(r);return"?"+o},o=function(){var t=e.location,a=t.pathname,n=t.search;return{url:a+n,pathname:a,search:n,params:r()}},i=o(),l=i.url,u=i.pathname,s=t(util.extend({$lastUrl:l,$lastPathname:u,$lastType:"initial",getParams:r,stringifyParams:n,getLocation:o,route:function(t,a,r){r=r||"push",t=t||location.pathname,a=a||"";var i=o(),s=i.pathname,c=i.url;"replace"!==r&&(l=c,u=s),function(t,a,r){a=util.isObj(a)?n(a):a,e.history[r+"State"](null,null,t+a)}(t,a,r),"replace"===r?setTimeout(function(){return p({type:r})}):p({type:r})}},i));s.routerSwitch=function(t){var e=t.root,a=t.pathMap,r=t.noMatch,n=null,o=!1,i=s.pathname,l=s.$lastPathname,u=s.$lastUrl,p=s.$lastType,c=s.url===u;return r=r||"/",e?n=a["/"+i.split("/")[1]]||a[r]:a[i]?n=a[i]:l!==i&&a[l]?(s.route(u,location.search,"replace"),n=a[l],o=!0):r&&a[r]&&(s.route(r,location.search,"replace"),n=a[r]),{next:n,toLast:o,noChange:c,replacedLast:"replace"===p}};var p=function(t){s.$merge(util.extend({$lastUrl:"popstate"===t.type?s.url:l,$lastPathname:"popstate"===t.type?s.pathname:u,$lastType:t.type},o()))};return e.addEventListener("popstate",p),s};exports.createRouting=createRouting;
