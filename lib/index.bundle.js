!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@iosio/util")):"function"==typeof define&&define.amd?define(["exports","@iosio/util"],e):e((t=t||self).routing={},t.util)}(this,function(t,e){"use strict";t.createRouting=function(t){var n=window,a=function(t){if(!t)return"";var e=decodeURIComponent(t);return"false"!==e&&("true"===e||(0*+e==0?+e:e))},r=function(t){var e,r,o,i={};if(!((o=(t=t||n.location.search).indexOf("?"))<0)){for(var s=(t=t.substr(o+1)).split("&");e=s.shift();)void 0!==i[r=(e=e.split("=")).shift()]?i[r]=[].concat(i[r],a(e.shift())):i[r]=a(e.shift());return i}},o=function(t){var n,a,r,o=encodeURIComponent,i="";for(n in t)if(void 0!==(r=t[n]))if(e.isArray(r))for(a=0;a<r.length;a++)i&&(i+="&"),i+=o(n)+"="+o(r[a]);else i&&(i+="&"),i+=o(n)+"="+o(r);return"?"+i},i=function(){var t=n.location,e=t.pathname,a=t.search;return{url:e+a,pathname:e,search:a,params:r()}},s=i(),l=s.url,u=s.pathname,p=t(e.extend({$lastUrl:l,$lastPathname:u,$lastType:"initial",getParams:r,stringifyParams:o,getLocation:i,route:function(t,a,r){r=r||"push",t=t||location.pathname,a=a||"";var s=i(),p=s.pathname,f=s.url;"replace"!==r&&(l=f,u=p),function(t,a,r){a=e.isObj(a)?o(a):a,n.history[r+"State"](null,null,t+a)}(t,a,r),"replace"===r?setTimeout(function(){return c({type:r})}):c({type:r})}},s));p.routerSwitch=function(t){var e=t.root,n=t.pathMap,a=t.noMatch,r=null,o=!1,i=p.pathname,s=p.$lastPathname,l=p.$lastUrl,u=p.$lastType,c=p.url===l;return a=a||"/",e?r=n["/"+i.split("/")[1]]||n[a]:n[i]?r=n[i]:s!==i&&n[s]?(p.route(l,location.search,"replace"),r=n[s],o=!0):a&&n[a]&&(p.route(a,location.search,"replace"),r=n[a]),{next:r,toLast:o,noChange:c,replacedLast:"replace"===u}};var c=function(t){p.$merge(e.extend({$lastUrl:"popstate"===t.type?p.url:l,$lastPathname:"popstate"===t.type?p.pathname:u,$lastType:t.type},i()))};return n.addEventListener("popstate",c),p},Object.defineProperty(t,"__esModule",{value:!0})});
